<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Socket.IO WebSocket í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script> 
</head>
<body>
    <h1>Socket.IO WebSocket í…ŒìŠ¤íŠ¸</h1>
    <button onclick="connectSocket()">ğŸ”— Socket.IO ì—°ê²°</button>
    <div id="log"></div>

    <script>
        let socket;
    
        function logMessage(message) {
            document.getElementById("log").innerHTML += `<p>${message}</p>`;
        }
    
        function connectSocket() {
            const token = "token";  // ì‹¤ì œ ì¸ì¦ í† í° ì…ë ¥
    
            // âœ… FastAPI Socket.IO ì„œë²„ì— ì—°ê²°
            socket = io("http://localhost:8000", {
                path: "/socket.io",
                transports: ["websocket"],
                query: { token: token }
            });
    
            // âœ… ì—°ê²° ì„±ê³µ
            socket.on("connect", () => {
                logMessage(`âœ… Socket.IO ì—°ê²° ì„±ê³µ! (ID: ${socket.id})`);
            });
    
            // âœ… ì„œë²„ì—ì„œ ë©”ì‹œì§€ë¥¼ ë°›ì„ ë•Œ ì‹¤í–‰
            socket.on("message", (data) => {
                logMessage(`ğŸ“© ì„œë²„ë¡œë¶€í„° ë©”ì‹œì§€ ìˆ˜ì‹ : ${JSON.stringify(data)}`);
            });
    
            // âœ… ì„œë²„ì—ì„œ ê²Œì‹œê¸€ ì•Œë¦¼ ìˆ˜ì‹ 
            socket.on("newPost", (post) => {
                logMessage(`ğŸ†• ìƒˆë¡œìš´ ê²Œì‹œê¸€: <b>${post.post_title}</b> - ${post.post_text}`);
    
                // ê²Œì‹œê¸€ì„ ë™ì ìœ¼ë¡œ ì¶”ê°€
                const logDiv = document.getElementById("log");
                const newPostElement = document.createElement("div");
                newPostElement.innerHTML = `
                    <h3>${post.post_title}</h3>
                    <p>${post.post_text}</p>
                    <small>ì‘ì„±ì: ${post.user_email} | ì‹œê°„: ${post.post_time}</small>
                    <hr>
                `;
                logDiv.prepend(newPostElement);  // ìµœì‹  ê²Œì‹œê¸€ì´ ìœ„ë¡œ ì˜¤ë„ë¡ ì¶”ê°€
            });
    
            // âœ… ì—°ê²° í•´ì œ ì´ë²¤íŠ¸
            socket.on("disconnect", () => {
                logMessage("âŒ Socket.IO ì—°ê²° ì¢…ë£Œ");
            });
    
            // âœ… ì—°ê²° ì˜¤ë¥˜ ë°œìƒ ì‹œ ì²˜ë¦¬
            socket.on("connect_error", (error) => {
                logMessage("âŒ Socket.IO ì—°ê²° ì˜¤ë¥˜ ë°œìƒ: " + error.message);
                console.error(error);
            });
        }
    </script>
</body>
</html>